const ProduceSurvey = require('../DB/produceSurvey');

const createProduceSurvey = async ( req, res) => {
  console.log("Adding survey...")
  try{
      const produceSurvey = new ProduceSurvey({
         surveyNum: req.body.surveyNum,
         week: req.body.week,
         itemName: req.body.itemName,
         salePrice: req.body.salePrice,         
         firstDelivery: req.body.firstDelivery,
         secondDelivery: req.body.secondDelivery,
         thirdDelivery: req.body.thirdDelivery,
         forthDelivery: req.body.forthDelivery,
         fifthDelivery: req.body.fifthDelivery,
         amountRecived: req.body.amountRecived,
         amountRemaining: req.body.amountRemaining,
         ranOut: req.body.ranOut
     })
     const savedProduceSurvey = await produceSurvey.save();
     res.json(savedProduceSurvey);
     }catch(err){
       res.json({message:err});
     }
   };
const getAll = async ( req, res) => {
    console.log("Getting Stuff...")
    try{
      const allProduceSurveys = await ProduceSurvey.find();
      res.json(allProduceSurveys);
    }catch(err){
      res.json({message:err});
    }
  };

  const findById = async ( req, res) => {
    console.log("Getting survey...")
    try{
      const surveyByID = await ProduceSurvey.findById(req.params.id);
      res.json(surveyByID);
    }catch(err){
      res.json({message:err});
    }
  };

const findBySurveyNumber = async ( req, res) => {
    console.log("Getting survey...")
    try{
      const bySurveyNumber = await ProduceSurvey.find({surveyNum: { $regex: '.*' + req.params.surveyNum + '.*' }});
      res.json(bySurveyNumber);
    }catch(err){
      res.json({message:err});
    }
  };
const findByWeek = async ( req, res) => {
    console.log("Getting survey...")
    try{
      const byWeek = await ProduceSurvey.find({week: { $regex: '.*' + req.params.week + '.*' }});
      res.json(byWeek);
    }catch(err){
      res.json({message:err});
    }
};
const findByItemName = async ( req, res) => {
    console.log("Getting survey...")
    try{
      const byItemName = await ProduceSurvey.find({itemName: { $regex: '.*' + req.params.itemName + '.*' }});
      res.json(byItemName);
    }catch(err){
      res.json({message:err});
    }
};

const updateSurvey = async ( req, res) => {
    console.log("Updateing survey...")
    try{
        const update = await ProduceSurvey.updateOne({_id: req.params.id},
            {$set:
                {           
                    surveyNum: req.body.surveyNum,           
                    week: req.body.week,           
                    itemName: req.body.itemName,           
                    salePrice: req.body.salePrice,           
                    firstDelivery: req.body.firstDelivery,           
                    secondDelivery: req.body.secondDelivery,           
                    thirdDelivery: req.body.thirdDelivery,           
                    forthDelivery: req.body.forthDelivery,           
                    fifthDelivery: req.body.fifthDelivery,           
                    amountRecived: req.body.amountRecived,           
                    amountRemaining: req.body.amountRemaining,           
                    ranOut: req.body.ranOut
                }
            })
       res.json(update);
       }catch(err){
         res.json({message:err});
       }
     };

     const deleteSurvey = async ( req, res) => {
        console.log("Deleting survey...")
        try{
          const deleteSurvey = await ProduceSurvey.deleteOne({_id: req.params.id});
          res.json(deleteSurvey);
        }catch(err){
          res.json({message:err});
        }
    };  

  module.exports = {
    createProduceSurvey,
    getAll,
    findById,
    findBySurveyNumber,
    findByWeek,
    findByItemName,
    updateSurvey,
    deleteSurvey
  };